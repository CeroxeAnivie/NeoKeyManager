# NeoKeyManager

![Java](https://img.shields.io/badge/Java-21%2B-orange) ![License](https://img.shields.io/badge/License-MIT-blue) ![Status](https://img.shields.io/badge/Status-Production%20Ready-green) ![Version](https://img.shields.io/badge/Version-1.0.0-purple)

```text
   _   _            _  __          __  __                                   
  | \ | |          | |/ /         |  \/  |                                  
  |  \| | ___  ___ | ' / ___ _   _| \  / | __ _ _ __   __ _  __ _  ___ _ __ 
  | . ` |/ _ \/ _ \|  < / _ \ | | | |\/| |/ _` | '_ \ / _` |/ _` |/ _ \ '__|
  | |\  |  __/ (_) | . \  __/ |_| | |  | | (_| | | | | (_| | (_| |  __/ |   
  |_| \_|\___|\___/|_|\_\___|\__, |_|  |_|\__,_|_| |_|\__,_|\__, |\___|_|   
                              __/ |                          __/ |          
                             |___/                          |___/           
```

**NeoKeyManager (NKM)** æ˜¯ä¸“ä¸º [NeoProxyServer](https://github.com/CeroxeAnivie/NeoProxyServer) è®¾è®¡çš„ä¼ä¸šçº§ä¸­å¿ƒåŒ–å¯†é’¥ç®¡ç†ä¸é‰´æƒæœåŠ¡å™¨ã€‚

å®ƒå°† NeoProxyServer ä»å•æœºè¿è¡Œæ¨¡å¼å‡çº§ä¸º**åˆ†å¸ƒå¼é›†ç¾¤æ¨¡å¼**ï¼Œæä¾›ç»Ÿä¸€çš„å¯†é’¥åˆ†å‘ã€æµé‡ç»“ç®—ã€Web è®¿é—®æ§åˆ¶ä»¥åŠèŠ‚ç‚¹ç«¯å£æ˜ å°„åŠŸèƒ½ã€‚

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

*   **ğŸ›¡ï¸ å·¥ä¸šçº§å®‰å…¨æ€§**ï¼šæ”¯æŒå…¨é“¾è·¯ HTTPS/TLS åŠ å¯†ï¼ŒToken é‰´æƒï¼Œå†…ç½®åæ‰«æä¸é˜²æ¢æµ‹æœºåˆ¶ï¼ˆ200ms å»¶è¿Ÿå¹²æ‰°/é¦–å­—èŠ‚é¢„è¯»ï¼‰ã€‚
*   **âš¡ è™šæ‹Ÿçº¿ç¨‹æ¶æ„**ï¼šåŸºäº Java 21 Virtual Threads æ„å»ºï¼Œæä½çš„èµ„æºå ç”¨ï¼Œæ”¯æŒé«˜å¹¶å‘é‰´æƒè¯·æ±‚ã€‚
*   **ğŸ”„ å®æ—¶æµé‡ç»“ç®—**ï¼šæ¥æ”¶å„èŠ‚ç‚¹ NPS çš„æµé‡ä¸ŠæŠ¥ï¼Œå®æ—¶æ‰£é™¤ä½™é¢ï¼Œè‡ªåŠ¨ä¸‹çº¿è€—å°½æˆ–è¿‡æœŸçš„å¯†é’¥ã€‚
*   **ğŸŒ å›½é™…åŒ–æ”¯æŒ**ï¼šå†…ç½®ä¸­è‹±åŒè¯­æ—¥å¿—ä¸äº¤äº’æç¤ºï¼Œæ”¯æŒå¯åŠ¨å‚æ•°è‡ªåŠ¨åˆ‡æ¢ (`--zh-cn` / `--en-us`)ã€‚
*   **ğŸ”— çµæ´»çš„ç«¯å£æ˜ å°„**ï¼šæ”¯æŒåŒä¸€å¯†é’¥åœ¨ä¸åŒèŠ‚ç‚¹ (Node) æ˜ å°„åˆ°ä¸åŒç«¯å£ï¼Œè½»æ¾ç®¡ç†å¤§è§„æ¨¡èŠ‚ç‚¹é›†ç¾¤ã€‚
*   **ğŸ“¦ å¼€ç®±å³ç”¨**ï¼šé›¶å¤–éƒ¨ä¾èµ–ï¼Œå†…ç½® H2 é«˜æ€§èƒ½æ•°æ®åº“ã€‚

---

## ğŸš€ æ¶æ„å˜æ›´ä¸è¡Œä¸ºè¯´æ˜ (é‡è¦)

å½“ NeoProxyServer (NPS) æ¥å…¥ NeoKeyManager (NKM) åï¼ŒNPS çš„å·¥ä½œæ¨¡å¼å°†ä» **æœ¬åœ°æ¨¡å¼ (Local Mode)** åˆ‡æ¢ä¸º **æ‰˜ç®¡æ¨¡å¼ (Managed Mode)**ã€‚

### 1. æ•°æ®æƒè´£å˜æ›´

| ç‰¹æ€§ | æœ¬åœ°æ¨¡å¼ (Standalone) | æ‰˜ç®¡æ¨¡å¼ (Managed by NKM) |
| :--- | :--- | :--- |
| **æ•°æ®å­˜å‚¨** | å¯†é’¥å­˜å‚¨åœ¨ NPS æœ¬åœ°çš„ `sk.db` æ–‡ä»¶ä¸­ã€‚ | æ‰€æœ‰å¯†é’¥å­˜å‚¨åœ¨ NKM çš„æ•°æ®åº“ä¸­ï¼ŒNPS ä»…åšå†…å­˜ç¼“å­˜ã€‚ |
| **æµé‡ç»“ç®—** | NPS æœ¬åœ°è®¡ç®—å¹¶æ›´æ–°æœ¬åœ°æ•°æ®åº“ã€‚ | NPS ç¼“å­˜æµé‡å¹¶å®šæ—¶æ‰¹é‡ä¸ŠæŠ¥ç»™ NKMï¼Œç”± NKM ç»Ÿä¸€æ‰£è´¹ã€‚ |
| **è¿‡æœŸæ§åˆ¶** | NPS è½®è¯¢æœ¬åœ°æ•°æ®ã€‚ | NKM è®¡ç®—è¿‡æœŸ/è€—å°½ï¼Œé€šè¿‡ API å“åº”ä¸‹å‘ `kill_keys` æŒ‡ä»¤ã€‚ |
| **ç«¯å£ç®¡ç†** | ä»…æ”¯æŒå›ºå®šç«¯å£æˆ–æœ¬åœ°åŠ¨æ€èŒƒå›´ã€‚ | æ”¯æŒ**èŠ‚ç‚¹çº§æ˜ å°„** (Node Mapping)ï¼ŒåŒä¸€ Key å¯åœ¨ä¸åŒèŠ‚ç‚¹ä½¿ç”¨ä¸åŒç«¯å£ã€‚ |

### 2. NPS æ§åˆ¶å°è¡Œä¸ºå˜åŒ–

åœ¨ NPS æ¥å…¥ NKM åï¼ŒNPS çš„æ§åˆ¶å°æŒ‡ä»¤è¡Œä¸ºå°†å‘ç”Ÿæ˜¾è‘—å˜åŒ–ï¼Œä»¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ï¼š

*   **å¯†é’¥æ ‡è¯†**ï¼š
    *   åœ¨ NPS æ‰§è¡Œ `list` æˆ– `key list` æ—¶ï¼Œæ¥è‡ª NKM çš„å¯†é’¥å°†å¸¦æœ‰ **`(R)`** (Remote) æ ‡ç­¾ã€‚
    *   æœ¬åœ°é—ç•™çš„å¯†é’¥å°†å¸¦æœ‰ **`(L)`** (Local) æ ‡ç­¾ã€‚
*   **å†™æ“ä½œæ‹¦æˆª (`key set`)**ï¼š
    *   âŒ **ç¦æ­¢ä¿®æ”¹**ï¼šä½ ä¸èƒ½åœ¨ NPSç«¯ä½¿ç”¨ `key set` ä¿®æ”¹å¸¦æœ‰ `(R)` æ ‡ç­¾çš„å¯†é’¥ï¼ˆå¦‚ä½™é¢ã€é€Ÿç‡ã€ç«¯å£ï¼‰ã€‚
    *   âœ… **æ­£ç¡®åšæ³•**ï¼šå¿…é¡»åœ¨ **NeoKeyManager** ä¸Šæ‰§è¡Œä¿®æ”¹ï¼ŒNPS ä¼šåœ¨ä¸‹ä¸€æ¬¡å¿ƒè·³æˆ–é‰´æƒæ—¶è‡ªåŠ¨åŒæ­¥ã€‚
*   **é˜²é‡åæœºåˆ¶ (`key add`)**ï¼š
    *   åœ¨ NPS ç«¯å°è¯•æ·»åŠ æœ¬åœ°å¯†é’¥æ—¶ï¼Œç³»ç»Ÿä¼šåŒæ—¶æ£€æŸ¥æœ¬åœ°æ•°æ®åº“å’Œè¿œç¨‹ NKM ç¼“å­˜ã€‚
    *   å¦‚æœ NKM ä¸­å·²å­˜åœ¨åŒåå¯†é’¥ï¼ŒNPS å°†æŠ¥é”™å¹¶é˜»æ­¢åˆ›å»ºï¼Œé˜²æ­¢å‘½åå†²çªã€‚
*   **WebHTML æ§åˆ¶**ï¼š
    *   Web è®¿é—®æƒé™ï¼ˆé˜² HTTP æ¢æµ‹ï¼‰å®Œå…¨ç”± NKM ä¸‹å‘ã€‚è‹¥ NKM ç¦ç”¨äº†æŸ Key çš„ Web è®¿é—®ï¼ŒNPS ä¼šç›´æ¥åˆ‡æ–­è¯¥ Key çš„ HTTP å¤´è¯·æ±‚ã€‚

---

## ğŸ› ï¸ å®‰è£…ä¸é…ç½®

### 1. ç¯å¢ƒè¦æ±‚
*   **Java 21** æˆ–æ›´é«˜ç‰ˆæœ¬ (å¿…é¡»æ”¯æŒ Virtual Threads)ã€‚

### 2. å¯åŠ¨ NeoKeyManager

é¦–æ¬¡è¿è¡Œå°†è‡ªåŠ¨ç”Ÿæˆ `server.properties` é…ç½®æ–‡ä»¶ã€‚

```bash
# é»˜è®¤å¯åŠ¨ (è‡ªåŠ¨æ£€æµ‹è¯­è¨€)
java -jar NeoKeyManager.jar

# å¼ºåˆ¶ä¸­æ–‡å¯åŠ¨
java -jar NeoKeyManager.jar --zh-cn
```

### 3. æœåŠ¡ç«¯é…ç½® (`server.properties`)

```properties
# æœåŠ¡ç›‘å¬ç«¯å£
SERVER_PORT=8080

# é‰´æƒ Token (NPS è¿æ¥æ—¶éœ€åŒ¹é…æ­¤ Token)
AUTH_TOKEN=your_secure_token_here

# æ•°æ®åº“è·¯å¾„ (H2)
DB_PATH=./neokey_db

# SSL é…ç½® (é…ç½®åè‡ªåŠ¨å¼€å¯ HTTPSï¼Œç•™ç©ºåˆ™ä¸º HTTP)
# å»ºè®®é…ç½® SSL ä»¥é˜²æ­¢ä¸­é—´äººæ”»å‡»çªƒå– Token
SSL_CRT_PATH=/path/to/cert.pem
SSL_KEY_PATH=/path/to/key.pem
```

---

## ğŸ”Œ æ¥å…¥æŒ‡å— (NPS ç«¯è®¾ç½®)

åœ¨ **NeoProxyServer** çš„é…ç½®æ–‡ä»¶ (`config.cfg` æˆ– `neoproxyserver.properties`) ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®å³å¯æ¥å…¥ï¼š

```properties
# å¯ç”¨è¿œç¨‹ç®¡ç†æ¨¡å¼
manager_url=https://<NKM_IP>:8080
manager_token=your_secure_token_here

# å½“å‰ NPS èŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯† (ç”¨äºç«¯å£æ˜ å°„)
node_id=Node_Tokyo_01
```

æ¥å…¥æˆåŠŸåï¼ŒNPS æ§åˆ¶å°æ—¥å¿—å°†æ˜¾ç¤ºï¼š`Provider initialized: REMOTE (NKM)`ã€‚

---

## ğŸ“– å‘½ä»¤æ‰‹å†Œ (NKM Console)

NeoKeyManager æä¾›äº†ä¸ NPS é£æ ¼ä¸€è‡´çš„æ§åˆ¶å°ç®¡ç†å‘½ä»¤ã€‚

### å¯†é’¥ç®¡ç†

*   **æ·»åŠ å¯†é’¥**
    ```bash
    key add <name> <balance> <expireTime> <port> <rate> [webHTML]
    # ç¤ºä¾‹:
    key add user1 1000 2025/12/31-23:59 30000 50 true
    ```
    *æ³¨æ„ï¼š`<port>` å¯ä»¥æ˜¯å•ä¸ªç«¯å£ (8080) æˆ–èŒƒå›´ (30000-30005)ã€‚*

*   **ä¿®æ”¹å¯†é’¥**
    ```bash
    key set <name> [b=<ä½™é¢>] [r=<é€Ÿç‡>] [p=<ç«¯å£>] [t=<è¿‡æœŸæ—¶é—´>] [w=<webHTML>]
    # ç¤ºä¾‹:
    key set user1 b=5000 r=100 w=false
    ```

*   **å¯åœå¯†é’¥**
    ```bash
    key enable <name>
    key disable <name>
    ```

*   **Web è®¿é—®æ§åˆ¶** (å¿«æ·æŒ‡ä»¤)
    ```bash
    web enable <name>
    web disable <name>
    ```

### èŠ‚ç‚¹ç«¯å£æ˜ å°„ (Mapping)

æ­¤åŠŸèƒ½å…è®¸åŒä¸€ä¸ª Key åœ¨ä¸åŒçš„ NPS èŠ‚ç‚¹ä¸Šä½¿ç”¨ä¸åŒçš„ç«¯å£ã€‚

*   **æ·»åŠ æ˜ å°„**
    ```bash
    key map <name> <node_id> <custom_port>
    # ç¤ºä¾‹: è®© user1 åœ¨èŠ‚ç‚¹ "US_Node" ä¸Šä½¿ç”¨ 443 ç«¯å£ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ 30000
    key map user1 US_Node 443
    ```
    *æ³¨æ„ï¼š`node_id` åŒ¹é…ä¸åŒºåˆ†å¤§å°å†™ã€‚*

*   **åˆ é™¤æ˜ å°„**
    ```bash
    key delmap <name> <node_id>
    ```

### ç³»ç»Ÿç»´æŠ¤

*   **åˆ—å‡ºæ‰€æœ‰å¯†é’¥**ï¼š`key list`
*   **åˆ é™¤å¯†é’¥**ï¼š`key del <name>`
*   **çƒ­é‡è½½é…ç½®**ï¼š`reload` (æ”¯æŒçƒ­æ›´æ›¿è¯ä¹¦ã€Tokenï¼Œè‹¥ç«¯å£/è¯ä¹¦å˜æ›´ä¼šè‡ªåŠ¨é‡å¯ WebServer)
*   **åœæ­¢æœåŠ¡å™¨**ï¼š`stop`

---

## ğŸ“ å¼€æºåè®®

MIT License.

---
*Developed for NeoProxyServer ecosystem.*